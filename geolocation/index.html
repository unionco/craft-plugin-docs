<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Geolocation | Union Craft Plugins</title>
    <meta name="description" content="">
    
    
    <link rel="preload" href="/craft-plugin-docs/assets/css/styles.35a8783f.css" as="style"><link rel="preload" href="/craft-plugin-docs/assets/js/app.35a8783f.js" as="script"><link rel="preload" href="/craft-plugin-docs/assets/js/1.29d4faf4.js" as="script"><link rel="prefetch" href="/craft-plugin-docs/assets/js/2.e3a0ad87.js"><link rel="prefetch" href="/craft-plugin-docs/assets/js/3.14e8ddbf.js"><link rel="prefetch" href="/craft-plugin-docs/assets/js/4.ac711c45.js"><link rel="prefetch" href="/craft-plugin-docs/assets/js/5.a8069cc9.js"><link rel="prefetch" href="/craft-plugin-docs/assets/js/6.eedee75c.js"><link rel="prefetch" href="/craft-plugin-docs/assets/js/7.ce8b67d0.js"><link rel="prefetch" href="/craft-plugin-docs/assets/js/8.952f457e.js"><link rel="prefetch" href="/craft-plugin-docs/assets/js/9.07752ec1.js">
    <link rel="stylesheet" href="/craft-plugin-docs/assets/css/styles.35a8783f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/craft-plugin-docs/" class="home-link router-link-active"><!----><span class="site-name">Union Craft Plugins</span></a><div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><nav class="nav-links can-hide"><div class="nav-item"><a href="/craft-plugin-docs/" class="nav-link">Home</a></div><div class="nav-item"><a href="/craft-plugin-docs/craft-sync-db/" class="nav-link">Craft SyncDB</a></div><div class="nav-item"><a href="/craft-plugin-docs/calendarize/" class="nav-link">Calendarize</a></div><div class="nav-item"><a href="/craft-plugin-docs/syncdb/" class="nav-link">SyncDB</a></div><div class="nav-item"><a href="/craft-plugin-docs/ticketmaster/" class="nav-link">Ticketmaster</a></div><div class="nav-item"><a href="/craft-plugin-docs/craft-related-entry-types/" class="nav-link">Related Entry Types</a></div><div class="nav-item"><a href="/craft-plugin-docs/geolocation/" aria-current="page" class="nav-link router-link-exact-active router-link-active">Geolocation</a></div><div class="nav-item"><a href="https://www.union.co/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  UNION
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><!----></nav></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/craft-plugin-docs/" class="nav-link">Home</a></div><div class="nav-item"><a href="/craft-plugin-docs/craft-sync-db/" class="nav-link">Craft SyncDB</a></div><div class="nav-item"><a href="/craft-plugin-docs/calendarize/" class="nav-link">Calendarize</a></div><div class="nav-item"><a href="/craft-plugin-docs/syncdb/" class="nav-link">SyncDB</a></div><div class="nav-item"><a href="/craft-plugin-docs/ticketmaster/" class="nav-link">Ticketmaster</a></div><div class="nav-item"><a href="/craft-plugin-docs/craft-related-entry-types/" class="nav-link">Related Entry Types</a></div><div class="nav-item"><a href="/craft-plugin-docs/geolocation/" aria-current="page" class="nav-link router-link-exact-active router-link-active">Geolocation</a></div><div class="nav-item"><a href="https://www.union.co/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  UNION
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><!----></nav><ul class="sidebar-links"><li><a href="/craft-plugin-docs/geolocation/" aria-current="page" class="active sidebar-link">Geolocation</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/craft-plugin-docs/geolocation/#overview" class="sidebar-link">Overview</a></li><li class="sidebar-sub-header"><a href="/craft-plugin-docs/geolocation/#requirements" class="sidebar-link">Requirements</a></li><li class="sidebar-sub-header"><a href="/craft-plugin-docs/geolocation/#installation" class="sidebar-link">Installation</a></li><li class="sidebar-sub-header"><a href="/craft-plugin-docs/geolocation/#configuration" class="sidebar-link">Configuration</a></li><li class="sidebar-sub-header"><a href="/craft-plugin-docs/geolocation/#geolocation" class="sidebar-link">Geolocation</a></li><li class="sidebar-sub-header"><a href="/craft-plugin-docs/geolocation/#closest-locations" class="sidebar-link">Closest Locations</a></li><li class="sidebar-sub-header"><a href="/craft-plugin-docs/geolocation/#location-distance" class="sidebar-link">Location Distance</a></li><li class="sidebar-sub-header"><a href="/craft-plugin-docs/geolocation/#events" class="sidebar-link">Events</a></li><li class="sidebar-sub-header"><a href="/craft-plugin-docs/geolocation/#extending-geolocation-providers" class="sidebar-link">Extending Geolocation Providers</a></li><li class="sidebar-sub-header"><a href="/craft-plugin-docs/geolocation/#tips" class="sidebar-link">Tips</a></li></ul></li></ul></div><div class="page"><!----><div class="content"><h1>Geolocation</h1><img src="/craft-plugin-docs/assets/img/craft-geolocation-logo.84c9a02c.svg" height="200px"><h2 id="overview"><a href="#overview" aria-hidden="true" class="header-anchor">#</a> Overview</h2><p>Craft 3 plugin to integrate geolocation and distance calculation helpers.</p><p>This plugin comes with two pre-configured geolocation providers: <a href="https://ipstack.com" target="_blank" rel="noopener noreferrer">IPStack<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> and <a href="https://developers.google.com/maps/documentation/geocoding/intro" target="_blank" rel="noopener noreferrer">Google Maps<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. Additionally, it provides an interface and various events to allow you to use any geolocation provider you desire. See the Extending Geolocation Providers section, below.</p><div><p>For calculating distance between elements, requires the <code>Map</code> field provided by <a href="https://github.com/ethercreative/simplemap" target="_blank" rel="noopener noreferrer">Ether Creative's Maps Plugin<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p></div><p>Source code is available on <a href="https://github.com/unionco/craft-geolocation" target="_blank" rel="noopener noreferrer">Github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p><h2 id="requirements"><a href="#requirements" aria-hidden="true" class="header-anchor">#</a> Requirements</h2><p>This plugin requires Craft CMS 3.0.0-beta.23 or later.</p><p><a href="https://github.com/ethercreative/simplemap" target="_blank" rel="noopener noreferrer">Ether Creative's Maps Plugin<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p><h2 id="installation"><a href="#installation" aria-hidden="true" class="header-anchor">#</a> Installation</h2><p>To install the plugin, follow these instructions.</p><ol><li><p>Open your terminal and go to your Craft project:</p><pre><code> `cd /path/to/project`
</code></pre></li><li><p>Then tell Composer to load the plugin:</p><pre><code> `composer require unionco/craft-geolocation`
</code></pre></li><li><p>In the Control Panel, go to Settings → Plugins and click the “Install” button for craft-geolocation.</p></li></ol><h2 id="configuration"><a href="#configuration" aria-hidden="true" class="header-anchor">#</a> Configuration</h2><img src="/craft-plugin-docs/assets/img/craft-geolocation-settings1.945a1273.png"><div><p>Each geolocation provider can have its own settings, in most cases this would just be an API key, but it is configured in the provider's <code>getSettingsHtml</code> method.</p></div><p>IP Override can be configured here in a table interface, as well as programatically (see Events, below).</p><h2 id="geolocation"><a href="#geolocation" aria-hidden="true" class="header-anchor">#</a> Geolocation</h2><div><p>Geolocation coordinates are queried using the <code>getCoords</code> method from the <code>Geolocation</code> service. The only parameter is the IP address, which is optional. If empty, the IP address is retrieved from the user's remote IP.</p></div><p>In PHP:</p><div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">use</span> <span class="token package">unionco<span class="token punctuation">\</span>geolocation<span class="token punctuation">\</span>GeolocationPlugin</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">unionco<span class="token punctuation">\</span>geolocation<span class="token punctuation">\</span>models<span class="token punctuation">\</span>LatLng</span><span class="token punctuation">;</span>

<span class="token comment">/** @var Geolocation */</span>
<span class="token variable">$geolocationService</span> <span class="token operator">=</span> <span class="token class-name static-context">GeolocationPlugin</span><span class="token operator">::</span><span class="token variable">$plugin</span><span class="token operator">-&gt;</span><span class="token property">geolocation</span><span class="token punctuation">;</span>

<span class="token comment">/** @var LatLng */</span>
<span class="token variable">$coords</span> <span class="token operator">=</span> <span class="token variable">$geolocationService</span><span class="token operator">-&gt;</span><span class="token function">getCoords</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></code></pre></div><p>In Twig:</p><div class="language-twig extra-class"><pre class="language-twig"><code><span class="token tag"><span class="token ld"><span class="token punctuation">{%</span> <span class="token keyword">set</span></span> <span class="token property">coords</span> <span class="token operator">=</span> <span class="token property">geolocation</span><span class="token punctuation">.</span><span class="token property">getCoords</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token rd"><span class="token punctuation">%}</span></span></span>
</code></pre></div><p>See the Tips section, below, for an example of geolocation caching.</p><h2 id="closest-locations"><a href="#closest-locations" aria-hidden="true" class="header-anchor">#</a> Closest Locations</h2><div><p>Elements can be searched by proximity to a given center point, which defaults to the user's geolocation. To search for elements by proximity, use the Location service <code>search</code> method. The <code>search</code> method requires:</p></div><div><ol><li>An <code>ElementQueryInterface</code> to narrow down the scope of returned elements
<ol><li>For example, <code>Entry::find()-&gt;section('locations')-&gt;limit(10)</code> to search for only entries in the 'locations' section.</li></ol></li><li>An optional <code>LatLng</code> which is the center for the search.
<ol><li>Defaults to geolocation</li></ol></li><li>An optional array of additional options
<ol><li><code>units</code>, which can be 'mi' (default) for miles, 'km' for kilometers, or 'm' for meters</li><li><code>radius</code> to reduce the search radius. Uses whichever units are specified for the search.</li><li><code>prefetchElements</code> to return an element in the results instead of just it's ID. Defaults to true.</li></ol></li></ol></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>Setting <code>prefetchElements</code> to false will increase performance if you don't need the full element in the search result</p></div><div><p>The <code>search</code> method returns an array of <code>SearchResult</code> objects. Each <code>SearchResult</code> contains an element (or its ID if prefetch is disabled), the distance from the center point, the units for the distance, and the element's coordinates.</p></div><p>In PHP:</p><div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">use</span> <span class="token package">craft<span class="token punctuation">\</span>elements<span class="token punctuation">\</span>Entry</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">unionco<span class="token punctuation">\</span>geolocation<span class="token punctuation">\</span>GeolocationPlugin</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">unionco<span class="token punctuation">\</span>geolocation<span class="token punctuation">\</span>services<span class="token punctuation">\</span>Location</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">unionco<span class="token punctuation">\</span>geolocation<span class="token punctuation">\</span>models<span class="token punctuation">\</span>SearchResult</span><span class="token punctuation">;</span>

<span class="token comment">/** @var Location */</span>
<span class="token variable">$locationService</span> <span class="token operator">=</span> <span class="token class-name static-context">GeolocationPlugin</span><span class="token operator">::</span><span class="token variable">$plugin</span><span class="token operator">-&gt;</span><span class="token property">location</span><span class="token punctuation">;</span>

<span class="token comment">/** @var EntryQuery */</span>
<span class="token variable">$entryQuery</span> <span class="token operator">=</span> <span class="token class-name static-context">Entry</span><span class="token operator">::</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token operator">-&gt;</span><span class="token function">section</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'locations'</span><span class="token punctuation">)</span>
    <span class="token operator">-&gt;</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/** @var SearchResult[] */</span>
<span class="token variable">$searchResults</span> <span class="token operator">=</span> <span class="token variable">$locationService</span><span class="token operator">-&gt;</span><span class="token function">search</span><span class="token punctuation">(</span><span class="token variable">$entryQuery</span><span class="token punctuation">,</span> <span class="token constant">null</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
    <span class="token string single-quoted-string">'radius'</span> <span class="token operator">=&gt;</span> <span class="token number">25</span><span class="token punctuation">,</span>
    <span class="token string single-quoted-string">'units'</span> <span class="token operator">=&gt;</span> <span class="token class-name static-context">Location</span><span class="token operator">::</span><span class="token constant">DISTANCE_KILOMETERS</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$searchResults</span> <span class="token keyword">as</span> <span class="token variable">$searchResult</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">/** @var unionco\geolocation\models\LatLng */</span>
    <span class="token variable">$latLng</span> <span class="token operator">=</span> <span class="token variable">$searchResult</span><span class="token operator">-&gt;</span><span class="token property">latLng</span><span class="token punctuation">;</span>

    <span class="token comment">/** @var float */</span>
    <span class="token variable">$distance</span> <span class="token operator">=</span> <span class="token variable">$searchResult</span><span class="token operator">-&gt;</span><span class="token property">distance</span><span class="token punctuation">;</span>

    <span class="token comment">/** @var craft\base\Element */</span>
    <span class="token variable">$element</span> <span class="token operator">=</span> <span class="token variable">$searchResult</span><span class="token operator">-&gt;</span><span class="token property">element</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p>In Twig:</p><div class="language-twig extra-class"><pre class="language-twig"><code><span class="token tag"><span class="token ld"><span class="token punctuation">{%</span> <span class="token keyword">macro</span></span> <span class="token property">searchResults</span><span class="token punctuation">(</span><span class="token property">locations</span><span class="token punctuation">)</span> <span class="token rd"><span class="token punctuation">%}</span></span></span>
    <span class="token other"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>table<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>thead</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span> <span class="token attr-name">scope</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>col<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>element id<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span> <span class="token attr-name">scope</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>col<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>element title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span> <span class="token attr-name">scope</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>col<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>distance<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span> <span class="token attr-name">scope</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>col<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>units<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span> <span class="token attr-name">scope</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>col<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>(lat,lng)<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>thead</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tbody</span><span class="token punctuation">&gt;</span></span></span>
        <span class="token tag"><span class="token ld"><span class="token punctuation">{%</span> <span class="token keyword">for</span></span> <span class="token property">result</span> <span class="token operator">in</span> <span class="token property">locations</span> <span class="token rd"><span class="token punctuation">%}</span></span></span>
            <span class="token other"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span></span><span class="token tag"><span class="token ld"><span class="token punctuation">{{</span></span> <span class="token property">result</span><span class="token punctuation">.</span><span class="token property">element</span><span class="token punctuation">.</span><span class="token property">id</span> <span class="token operator">?</span><span class="token operator">?</span> <span class="token property">result</span><span class="token punctuation">.</span><span class="token property">element</span> <span class="token rd"><span class="token punctuation">}}</span></span></span><span class="token other"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span></span><span class="token tag"><span class="token ld"><span class="token punctuation">{{</span></span> <span class="token property">result</span><span class="token punctuation">.</span><span class="token property">element</span><span class="token punctuation">.</span><span class="token property">title</span> <span class="token operator">?</span><span class="token operator">?</span> <span class="token string"><span class="token punctuation">'</span>n/a<span class="token punctuation">'</span></span> <span class="token rd"><span class="token punctuation">}}</span></span></span><span class="token other"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span></span><span class="token tag"><span class="token ld"><span class="token punctuation">{{</span></span> <span class="token property">result</span><span class="token punctuation">.</span><span class="token property">distance</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token string"><span class="token punctuation">'</span>0<span class="token punctuation">'</span></span> <span class="token punctuation">:</span> <span class="token property">result</span><span class="token punctuation">.</span><span class="token property">distance</span> <span class="token rd"><span class="token punctuation">}}</span></span></span><span class="token other"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span></span><span class="token tag"><span class="token ld"><span class="token punctuation">{{</span></span> <span class="token property">result</span><span class="token punctuation">.</span><span class="token property">units</span> <span class="token rd"><span class="token punctuation">}}</span></span></span><span class="token other"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>(</span><span class="token tag"><span class="token ld"><span class="token punctuation">{{</span></span> <span class="token property">result</span><span class="token punctuation">.</span><span class="token property">latLng</span><span class="token punctuation">.</span><span class="token property">lat</span> <span class="token rd"><span class="token punctuation">}}</span></span></span><span class="token other">,</span> <span class="token tag"><span class="token ld"><span class="token punctuation">{{</span></span> <span class="token property">result</span><span class="token punctuation">.</span><span class="token property">latLng</span><span class="token punctuation">.</span><span class="token property">lng</span> <span class="token rd"><span class="token punctuation">}}</span></span></span><span class="token other">)<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span></span>
        <span class="token tag"><span class="token ld"><span class="token punctuation">{%</span> <span class="token keyword">endfor</span></span> <span class="token rd"><span class="token punctuation">%}</span></span></span>
        <span class="token other"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tbody</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">&gt;</span></span></span>
<span class="token tag"><span class="token ld"><span class="token punctuation">{%</span> <span class="token keyword">endmacro</span></span> <span class="token rd"><span class="token punctuation">%}</span></span></span>

<span class="token tag"><span class="token ld"><span class="token punctuation">{%</span> <span class="token keyword">import</span></span> <span class="token property">_self</span> <span class="token property">as</span> <span class="token property">searchResults</span> <span class="token rd"><span class="token punctuation">%}</span></span></span>

<span class="token other"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>Closest Locations to me (miles, max: 200mi)<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span></span>
<span class="token tag"><span class="token ld"><span class="token punctuation">{%</span> <span class="token keyword">set</span></span> <span class="token property">query</span> <span class="token operator">=</span> <span class="token property">craft</span><span class="token punctuation">.</span><span class="token property">entries</span><span class="token punctuation">.</span><span class="token property">section</span><span class="token punctuation">(</span><span class="token string"><span class="token punctuation">'</span>locations<span class="token punctuation">'</span></span><span class="token punctuation">)</span> <span class="token rd"><span class="token punctuation">%}</span></span></span>
<span class="token tag"><span class="token ld"><span class="token punctuation">{%</span> <span class="token keyword">set</span></span> <span class="token property">locations</span> <span class="token operator">=</span> <span class="token property">location</span><span class="token punctuation">.</span><span class="token property">search</span><span class="token punctuation">(</span><span class="token property">query</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token property">prefetchElements</span><span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">radius</span><span class="token punctuation">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
    <span class="token property">sources</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string"><span class="token punctuation">'</span>entries:section:3<span class="token punctuation">'</span></span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token rd"><span class="token punctuation">%}</span></span></span>

<span class="token tag"><span class="token ld"><span class="token punctuation">{{</span></span> <span class="token property">searchResults</span><span class="token punctuation">.</span><span class="token property">searchResults</span><span class="token punctuation">(</span><span class="token property">locations</span><span class="token punctuation">)</span> <span class="token rd"><span class="token punctuation">}}</span></span></span>

<span class="token other"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hr</span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>Closest Entries to me (kilometers, max: 200km)<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span></span>
<span class="token tag"><span class="token ld"><span class="token punctuation">{%</span> <span class="token keyword">set</span></span> <span class="token property">query</span> <span class="token operator">=</span> <span class="token property">craft</span><span class="token punctuation">.</span><span class="token property">entries</span> <span class="token rd"><span class="token punctuation">%}</span></span></span>
<span class="token tag"><span class="token ld"><span class="token punctuation">{%</span> <span class="token keyword">set</span></span> <span class="token property">locations</span> <span class="token operator">=</span> <span class="token property">location</span><span class="token punctuation">.</span><span class="token property">search</span><span class="token punctuation">(</span><span class="token property">query</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token property">prefetchElements</span><span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">radius</span><span class="token punctuation">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
    <span class="token property">units</span><span class="token punctuation">:</span> <span class="token string"><span class="token punctuation">'</span>km<span class="token punctuation">'</span></span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token rd"><span class="token punctuation">%}</span></span></span>

<span class="token tag"><span class="token ld"><span class="token punctuation">{{</span></span> <span class="token property">searchResults</span><span class="token punctuation">.</span><span class="token property">searchResults</span><span class="token punctuation">(</span><span class="token property">locations</span><span class="token punctuation">)</span> <span class="token rd"><span class="token punctuation">}}</span></span></span>

<span class="token other"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hr</span><span class="token punctuation">/&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>Closest Locations to Winston Salem (not prefetching elements)<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span></span>
<span class="token tag"><span class="token ld"><span class="token punctuation">{%</span> <span class="token keyword">set</span></span> <span class="token property">winston</span> <span class="token operator">=</span> <span class="token property">craft</span><span class="token punctuation">.</span><span class="token property">entries</span><span class="token punctuation">.</span><span class="token property">id</span><span class="token punctuation">(</span><span class="token number">33</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property">one</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token rd"><span class="token punctuation">%}</span></span></span>
<span class="token tag"><span class="token ld"><span class="token punctuation">{%</span> <span class="token keyword">set</span></span> <span class="token property">winstonCoords</span> <span class="token operator">=</span> <span class="token property">location</span><span class="token punctuation">.</span><span class="token property">getCoords</span><span class="token punctuation">(</span><span class="token property">winston</span><span class="token punctuation">)</span> <span class="token rd"><span class="token punctuation">%}</span></span></span>
<span class="token tag"><span class="token ld"><span class="token punctuation">{%</span> <span class="token keyword">set</span></span> <span class="token property">query</span> <span class="token operator">=</span> <span class="token property">craft</span><span class="token punctuation">.</span><span class="token property">entries</span><span class="token punctuation">.</span><span class="token property">section</span><span class="token punctuation">(</span><span class="token string"><span class="token punctuation">'</span>locations<span class="token punctuation">'</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property">limit</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token rd"><span class="token punctuation">%}</span></span></span>
<span class="token tag"><span class="token ld"><span class="token punctuation">{%</span> <span class="token keyword">set</span></span> <span class="token property">locations</span> <span class="token operator">=</span> <span class="token property">location</span><span class="token punctuation">.</span><span class="token property">search</span><span class="token punctuation">(</span><span class="token property">query</span><span class="token punctuation">,</span> <span class="token property">winstonCoords</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token property">radius</span><span class="token punctuation">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
    <span class="token property">prefetchElements</span><span class="token punctuation">:</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token rd"><span class="token punctuation">%}</span></span></span>

<span class="token tag"><span class="token ld"><span class="token punctuation">{{</span></span> <span class="token property">searchResults</span><span class="token punctuation">.</span><span class="token property">searchResults</span><span class="token punctuation">(</span><span class="token property">locations</span><span class="token punctuation">)</span> <span class="token rd"><span class="token punctuation">}}</span></span></span>

</code></pre></div><img src="/craft-plugin-docs/assets/img/craft-geolocation-screen1.732e1c0d.png"><h2 id="location-distance"><a href="#location-distance" aria-hidden="true" class="header-anchor">#</a> Location Distance</h2><div><p>Distance between two elements can be calculated based on their fields. By default, the <code>distance</code> method looks for the first <code>ether\simplemap\fields\MapField</code> field on each element. If you know the handle of the map field, or your Element has more than one Map field, this logic can be overwritten by the second parameter, <code>fieldHandle</code>.</p></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>Manually specifying the <code>fieldHandle</code> will increase performance by reducing database queries</p></div><p>In PHP:</p><div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">use</span> <span class="token package">unionco<span class="token punctuation">\</span>geolocation<span class="token punctuation">\</span>GeolocationPlugin</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">unionco<span class="token punctuation">\</span>geolocaiton<span class="token punctuation">\</span>services<span class="token punctuation">\</span>Location</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">unionco<span class="token punctuation">\</span>geolocation<span class="token punctuation">\</span>models<span class="token punctuation">\</span>LatLng</span><span class="token punctuation">;</span>

<span class="token comment">/** @var craft\elements\Entry */</span>
<span class="token variable">$entryA</span> <span class="token operator">=</span> <span class="token operator">...</span><span class="token punctuation">;</span>

<span class="token comment">/** @var craft\elements\Entry */</span>
<span class="token variable">$entryB</span> <span class="token operator">=</span> <span class="token operator">...</span><span class="token punctuation">;</span>

<span class="token comment">/** @var Location */</span>
<span class="token variable">$locationService</span> <span class="token operator">=</span> <span class="token class-name static-context">GeolocationPlugin</span><span class="token operator">::</span><span class="token variable">$plugin</span><span class="token operator">-&gt;</span><span class="token property">location</span><span class="token punctuation">;</span>

<span class="token variable">$distance</span> <span class="token operator">=</span> <span class="token variable">$locationService</span><span class="token operator">-&gt;</span><span class="token function">distance</span><span class="token punctuation">(</span><span class="token variable">$entryA</span><span class="token punctuation">,</span> <span class="token variable">$entryB</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Get the distance based on a specific field handle, 'officeLocation'</span>
<span class="token variable">$distance</span> <span class="token operator">=</span> <span class="token variable">$locationService</span><span class="token operator">-&gt;</span><span class="token function">distance</span><span class="token punctuation">(</span><span class="token variable">$entryA</span><span class="token punctuation">,</span> <span class="token variable">$entryB</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'officeLocation'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Get the distance in kilometers</span>
<span class="token variable">$distance</span> <span class="token operator">=</span> <span class="token variable">$locationService</span>
    <span class="token operator">-&gt;</span><span class="token function">distance</span><span class="token punctuation">(</span><span class="token variable">$entryA</span><span class="token punctuation">,</span> <span class="token variable">$entryB</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'officeLocation'</span><span class="token punctuation">,</span> <span class="token class-name static-context">Location</span><span class="token operator">::</span><span class="token constant">DISTANCE_KILOMETERS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></code></pre></div><p>In Twig:</p><div class="language-twig extra-class"><pre class="language-twig"><code><span class="token tag"><span class="token ld"><span class="token punctuation">{%</span> <span class="token keyword">set</span></span> <span class="token property">entryA</span> <span class="token operator">=</span> <span class="token property">craft</span><span class="token punctuation">.</span><span class="token property">entries</span><span class="token punctuation">.</span><span class="token property">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property">one</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token rd"><span class="token punctuation">%}</span></span></span>
<span class="token tag"><span class="token ld"><span class="token punctuation">{%</span> <span class="token keyword">set</span></span> <span class="token property">entryB</span> <span class="token operator">=</span> <span class="token property">craft</span><span class="token punctuation">.</span><span class="token property">entries</span><span class="token punctuation">.</span><span class="token property">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property">one</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token rd"><span class="token punctuation">%}</span></span></span>

<span class="token tag"><span class="token ld"><span class="token punctuation">{%</span> <span class="token keyword">set</span></span> <span class="token property">distance</span> <span class="token operator">=</span> <span class="token property">location</span><span class="token punctuation">.</span><span class="token property">distance</span><span class="token punctuation">(</span><span class="token property">entryA</span><span class="token punctuation">,</span> <span class="token property">entryB</span><span class="token punctuation">)</span> <span class="token rd"><span class="token punctuation">%}</span></span></span>
<span class="token tag"><span class="token ld"><span class="token punctuation">{%</span> <span class="token keyword">set</span></span> <span class="token property">distance</span> <span class="token operator">=</span> <span class="token property">location</span><span class="token punctuation">.</span><span class="token property">distance</span><span class="token punctuation">(</span><span class="token property">entryA</span><span class="token punctuation">,</span> <span class="token property">entryB</span><span class="token punctuation">,</span> <span class="token string"><span class="token punctuation">'</span>officeLocation<span class="token punctuation">'</span></span><span class="token punctuation">)</span> <span class="token rd"><span class="token punctuation">%}</span></span></span>
<span class="token tag"><span class="token ld"><span class="token punctuation">{%</span> <span class="token keyword">set</span></span> <span class="token property">distance</span> <span class="token operator">=</span> <span class="token property">location</span><span class="token punctuation">.</span><span class="token property">distance</span><span class="token punctuation">(</span><span class="token property">entryA</span><span class="token punctuation">,</span> <span class="token property">entryB</span><span class="token punctuation">,</span> <span class="token string"><span class="token punctuation">'</span>officeLocation<span class="token punctuation">'</span></span><span class="token punctuation">,</span> <span class="token string"><span class="token punctuation">'</span>km<span class="token punctuation">'</span></span><span class="token punctuation">)</span> <span class="token rd"><span class="token punctuation">%}</span></span></span>
</code></pre></div><h2 id="events"><a href="#events" aria-hidden="true" class="header-anchor">#</a> Events</h2><h3 id="geolocation-event-register-providers"><a href="#geolocation-event-register-providers" aria-hidden="true" class="header-anchor">#</a><code>Geolocation::EVENT_REGISTER_PROVIDERS</code></h3><div><p><code>RegisterProvidersEvent</code> - The event that is raised when registering geolocation providers</p></div><div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">use</span> <span class="token package">unionco<span class="token punctuation">\</span>geolocation<span class="token punctuation">\</span>events<span class="token punctuation">\</span>BeforeGeolocationEvent</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">unionco<span class="token punctuation">\</span>geolocation<span class="token punctuation">\</span>services<span class="token punctuation">\</span>Geolocation</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">yii<span class="token punctuation">\</span>base<span class="token punctuation">\</span>Event</span><span class="token punctuation">;</span>

<span class="token class-name static-context">Event</span><span class="token operator">::</span><span class="token function">on</span><span class="token punctuation">(</span>
    <span class="token class-name static-context">Geolocation</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">,</span>
    <span class="token class-name static-context">Geolocation</span><span class="token operator">::</span><span class="token constant">EVENT_BEFORE_GEOLOCATION</span><span class="token punctuation">,</span>
    <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token class-name type-declaration">BeforeGeolocationEvent</span> <span class="token variable">$event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$event</span><span class="token operator">-&gt;</span><span class="token property">providers</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token class-name static-context">MyCustomProvider</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></code></pre></div><h3 id="geolocation-event-before-geolocation"><a href="#geolocation-event-before-geolocation" aria-hidden="true" class="header-anchor">#</a><code>Geolocation::EVENT_BEFORE_GEOLOCATION</code></h3><div><p><code>BeforeGeolocationEvent</code> - Can be used to customize <code>ipOverrides</code>, allowing you to programmatically set custom rules for certain IP addresses. For example, you can assign coordinates to 127.0.0.1 during development or testing based on an environment variable.</p></div><p>This event is triggered immediately before making the geolocation provider API call.</p><div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">use</span> <span class="token package">unionco<span class="token punctuation">\</span>geolocation<span class="token punctuation">\</span>events<span class="token punctuation">\</span>BeforeGeolocationEvent</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">unionco<span class="token punctuation">\</span>geolocation<span class="token punctuation">\</span>services<span class="token punctuation">\</span>Geolocation</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">yii<span class="token punctuation">\</span>base<span class="token punctuation">\</span>Event</span><span class="token punctuation">;</span>

<span class="token class-name static-context">Event</span><span class="token operator">::</span><span class="token function">on</span><span class="token punctuation">(</span>
    <span class="token class-name static-context">Geolocation</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">,</span>
    <span class="token class-name static-context">Geolocation</span><span class="token operator">::</span><span class="token constant">EVENT_REGISTER_PROVIDERS</span><span class="token punctuation">,</span>
    <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token class-name type-declaration">BeforeGeolocationEvent</span> <span class="token variable">$event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">getenv</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'ENVIRONMENT'</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string single-quoted-string">'dev'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$event</span><span class="token operator">-&gt;</span><span class="token property">ipOverrides</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
                <span class="token string single-quoted-string">'127.0.0.1'</span><span class="token punctuation">,</span> <span class="token comment">// IP Address</span>
                <span class="token string single-quoted-string">'35.2270869'</span><span class="token punctuation">,</span> <span class="token comment">// Latitude</span>
                <span class="token string single-quoted-string">'-80.8431268'</span><span class="token punctuation">,</span> <span class="token comment">// Longitude</span>
            <span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></code></pre></div><h3 id="geolocation-event-after-geolocation"><a href="#geolocation-event-after-geolocation" aria-hidden="true" class="header-anchor">#</a><code>Geolocation::EVENT_AFTER_GEOLOCATION</code></h3><div><p><code>AfterGeolocation</code> - Can be used to handle geolocation errors or provider-specific quirks. For example, if an IP Address returns null coordinates, you can setup a default location.</p></div><div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">use</span> <span class="token package">unionco<span class="token punctuation">\</span>geolocation<span class="token punctuation">\</span>events<span class="token punctuation">\</span>AfterGeolocationEvent</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">unionco<span class="token punctuation">\</span>geolocation<span class="token punctuation">\</span>services<span class="token punctuation">\</span>Geolocation</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">unionco<span class="token punctuation">\</span>geolocation<span class="token punctuation">\</span>models<span class="token punctuation">\</span>LatLng</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">yii<span class="token punctuation">\</span>base<span class="token punctuation">\</span>Event</span><span class="token punctuation">;</span>

<span class="token class-name static-context">Event</span><span class="token operator">::</span><span class="token function">on</span><span class="token punctuation">(</span>
    <span class="token class-name static-context">Geolocation</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">,</span>
    <span class="token class-name static-context">Geolocation</span><span class="token operator">::</span><span class="token constant">EVENT_AFTER_GEOLOCATION</span><span class="token punctuation">,</span>
    <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token class-name type-declaration">AfterGeolocationEvent</span> <span class="token variable">$event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">/** @var LatLng */</span>
        <span class="token variable">$coordinates</span> <span class="token operator">=</span> <span class="token variable">$event</span><span class="token operator">-&gt;</span><span class="token property">coords</span><span class="token punctuation">;</span>

        <span class="token comment">// Some providers may return 0, 0 if the lookup failed</span>
        <span class="token variable">$possibleErrorResponse</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LatLng</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$coordinates</span><span class="token operator">-&gt;</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token variable">$possibleErrorResponse</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$event</span><span class="token operator">-&gt;</span><span class="token property">coords</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LatLng</span><span class="token punctuation">(</span><span class="token number">35.2270869</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">80.8431268</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name static-context">Craft</span><span class="token operator">::</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Manual override geolocation for IP: '</span> <span class="token operator">.</span> <span class="token variable">$event</span><span class="token operator">-&gt;</span><span class="token property">ipAddress</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></code></pre></div><h2 id="extending-geolocation-providers"><a href="#extending-geolocation-providers" aria-hidden="true" class="header-anchor">#</a> Extending Geolocation Providers</h2><div><p>A Geolocation provider must implement the <code>unionco\geolocation\interfaces\GeolocationProvider</code> interface. The class can optionally extend the <code>unionco\geolocaiton\provders\AbstractProvider</code> for some helpful boilerplate functionality.</p></div><div><p>See <code>unionco\geolocation\providers\{IPStackProvider,GoogleMapsProvider}</code> for example implementations.</p></div><h2 id="tips"><a href="#tips" aria-hidden="true" class="header-anchor">#</a> Tips</h2><p>To reduce API usage, you can cache user results in session storage or cookies:</p><div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">use</span> <span class="token package">Craft</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">unionco<span class="token punctuation">\</span>geolocation<span class="token punctuation">\</span>events<span class="token punctuation">\</span>BeforeGeolocationEvent</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">unionco<span class="token punctuation">\</span>geolocation<span class="token punctuation">\</span>events<span class="token punctuation">\</span>AfterGeolocationEvent</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">unionco<span class="token punctuation">\</span>geolocation<span class="token punctuation">\</span>services<span class="token punctuation">\</span>Geolocation</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">yii<span class="token punctuation">\</span>base<span class="token punctuation">\</span>Event</span><span class="token punctuation">;</span>

<span class="token class-name static-context">Event</span><span class="token operator">::</span><span class="token function">on</span><span class="token punctuation">(</span>
    <span class="token class-name static-context">Geolocation</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">,</span>
    <span class="token class-name static-context">Geolocation</span><span class="token operator">::</span><span class="token constant">EVENT_AFTER_GEOLOCATION</span><span class="token punctuation">,</span>
    <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token class-name type-declaration">AfterGeolocationEvent</span> <span class="token variable">$event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$session</span> <span class="token operator">=</span> <span class="token class-name static-context">Craft</span><span class="token operator">::</span><span class="token variable">$app</span><span class="token operator">-&gt;</span><span class="token property">session</span><span class="token punctuation">;</span>
        <span class="token variable">$session</span><span class="token operator">-&gt;</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'geolocation'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
            <span class="token string single-quoted-string">'ipAddress'</span> <span class="token operator">=&gt;</span> <span class="token class-name static-context">Craft</span><span class="token operator">::</span><span class="token variable">$app</span><span class="token operator">-&gt;</span><span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">getRemoteIp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'lat'</span> <span class="token operator">=&gt;</span> <span class="token variable">$coords</span><span class="token operator">-&gt;</span><span class="token function">getLat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'lng'</span> <span class="token operator">=&gt;</span> <span class="token variable">$coords</span><span class="token operator">-&gt;</span><span class="token function">getLng</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span>

<span class="token class-name static-context">Event</span><span class="token operator">::</span><span class="token function">on</span><span class="token punctuation">(</span>
    <span class="token class-name static-context">Geolocation</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">,</span>
    <span class="token class-name static-context">Geolocation</span><span class="token operator">::</span><span class="token constant">EVENT_REGISTER_PROVIDERS</span><span class="token punctuation">,</span>
    <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token class-name type-declaration">BeforeGeolocationEvent</span> <span class="token variable">$event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$session</span> <span class="token operator">=</span> <span class="token class-name static-context">Craft</span><span class="token operator">::</span><span class="token variable">$app</span><span class="token operator">-&gt;</span><span class="token property">session</span><span class="token punctuation">;</span>
        <span class="token variable">$userLocation</span> <span class="token operator">=</span> <span class="token variable">$session</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'geolocation'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$userLocation</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$event</span><span class="token operator">-&gt;</span><span class="token property">ipOverrides</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
                <span class="token variable">$userLocation</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'ipAddress'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// IP Address</span>
                <span class="token variable">$userLocation</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'lat'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// Latitude</span>
                <span class="token variable">$userLocation</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'lng'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// Longitude</span>
            <span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></code></pre></div></div><div class="page-edit"><div class="edit-link"><a href="https://github.com/unionco/craft-plugin-docs/edit/develop/docs/geolocation/README.md" target="_blank" rel="noopener noreferrer">Edit this page</a><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div><!----></div><!----></div><!----></div></div>
    <script src="/craft-plugin-docs/assets/js/app.35a8783f.js" defer></script><script src="/craft-plugin-docs/assets/js/1.29d4faf4.js" defer></script>
  </body>
</html>
